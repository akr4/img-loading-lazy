# React で `loading="lazy"` な `<img>` のロードに時間がかかる場合だけアニメーション効果をつける

## やりたいこと

`loading="lazy"` な `<img>` でロードに時間がかかるときだけアニメーション効果をつける。

(戻るボタンで戻ったときなどでキャッシュがある場合はアニメーション効果をつけない)

## 従来の方法

こういう関数でキャッシュの有無を判定していました。でもこれはロードするので `loading="lazy"` の効果がなくなってしまいます。

```
export const isCached = (url: string): boolean => {
  const img = new Image();
  img.src = url;
  return img.complete;
};
```

## 検討した手法

初回 `render` 時にタイムスタンプを保存しておいて `img.onLoad` 時に時間がかかっているならアニメーションを実行するようにしました。

実行方法

```
npm run start
```

Chrome の開発者ツールでキャッシュを有効/無効にして試すとアニメーションがついたりつかなかったりするのが確認できます。ロードに 20 ミリ秒以上かかった場合にアニメーションを有効化しています。
